package assignment2;

import java.util.*;
import java.io.*;

public class Game {
	boolean isTesting;
	
	public Game(boolean isTesting) {
		this.isTesting = isTesting;
	}
	
	public void runGame() {
		System.out.println("Do you want to play a new game? (Y/N) :");
		Scanner scan = new Scanner(System.in);
		String start = scan.next();
		if(start.equals("Y")) {
			startGame(scan);
		}		
	}
	
	private void startGame(Scanner scan) {
		
		boolean win = false;
		boolean valid = true;
		boolean keepPlaying = true;
		
		while(keepPlaying) {
			int numTurns = GameConfiguration.guessNumber;
			String secret_code = makeSecretCode();
			String guess = "";
			Decoder decode = new Decoder(secret_code, guess);
			while(!win && numTurns > 0) {
				System.out.println("You have " + numTurns + " guess(es) left.");
				valid = askForGuess(decode, scan, guess);
				System.out.println(guess);
				if(valid) {
					//askForClue();
				}
				else {
				numTurns--;
				if(numTurns == 0 || win) terminationMessage(win);
			}			
			keepPlaying = toContinue(scan);			
			}
		}
	}
	
	private String makeSecretCode() {
		SecretCodeGenerator code = SecretCodeGenerator.getInstance();
		String secret_code = code.getNewSecretCode();
		System.out.println("Secret code: "+ secret_code);
		System.out.println();
		return secret_code;
	}
	
	private boolean toContinue(Scanner scan) {
		System.out.println();
		System.out.println("Do you want to play a new game? (Y/N) :");
		String answer = scan.next();
		if(answer.equals("N")) {
			return false;
		}
		return true;
	}
	
	private boolean askForGuess(Decoder decode, Scanner scan, String guess) {
		System.out.println("Enter your guess: ");
		String input = scan.next();
		decode.setNewGuess(input);
		guess = input;
		return checkInputs(input);
	}
	
	public boolean checkInputs(String guess) {
		if(guess.length() > GameConfiguration.pegNumber || !guess.equals(guess.toUpperCase())) {
			System.out.println("INVALID_GUESS");
			System.out.println();	
			return false;
		}
		return true;
	}
	
	private void terminationMessage(boolean win) {
		if(win) {
			System.out.println("You win!");
		}
		else {
			System.out.println("You lose!");
		}		
	}
}
